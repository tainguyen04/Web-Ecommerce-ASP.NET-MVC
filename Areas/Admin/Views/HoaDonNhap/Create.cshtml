@model QLCHBanDienThoaiMoi.DTO.HoaDonNhapDTO
@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewBag.Title = "Th√™m Phi·∫øu Nh·∫≠p H√†ng";

    var sanPhamList = (List<QLCHBanDienThoaiMoi.Models.SanPham>)ViewBag.SanPhamList;
}

<h2>@ViewBag.Title</h2>

<form asp-action="Create" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />

    <div class="mb-3">
        <label>Nh√† Cung C·∫•p</label>
        <select asp-for="NhaCungCapId" class="form-control" asp-items="ViewBag.NCCList" style="color:black">
            <option value="">-- Ch·ªçn nh√† cung c·∫•p --</option>
        </select>
    </div>

    <div class="mb-3">
        <label>Ng√†y L·∫≠p</label>
        <input asp-for="NgayLap" type="date" class="form-control" value="@Model.NgayLap.ToString("yyyy-MM-dd")" style="color:black"/>
    </div>

    <table class="table table-bordered" id="productTable">
        <thead>
            <tr>
                <th>S·∫£n ph·∫©m</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>Gi√° nh·∫≠p</th>
                <th>Th√†nh ti·ªÅn</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.ChiTietSanPhams.Count; i++)
            {
                var chiTiet = Model.ChiTietSanPhams[i];
                <tr>
                    <td>
                        <select name="ChiTietSanPhams[@i].SanPhamId" class="form-control" style="color:black">
                            <select name="ChiTietSanPhams[${index}].SanPhamId" class="form-control"
                            style="color:black"> 
                            <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option> ${sanPhamOptions} </select>
                        </select>
                    </td>
                    <td><input type="number" name="ChiTietSanPhams[@i].SoLuong" value="@chiTiet.SoLuong" class="form-control" min="1" style="color:black"/></td>
                    <td><input type="number" name="ChiTietSanPhams[@i].GiaNhap" value="@chiTiet.GiaNhap" class="form-control" min="0" style="color:black"/></td>
                    <td>@chiTiet.ThanhTien</td>
                    <td><button type="button" class="btn btn-danger removeRow">X√≥a</button></td>
                </tr>
            }
        </tbody>
    </table>

    <button type="button" id="addRow" class="btn btn-primary mb-3">Th√™m s·∫£n ph·∫©m</button>
    <br/>
    <button type="submit" class="btn btn-success">üíæ L∆∞u Phi·∫øu Nh·∫≠p</button>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var index = @Model.ChiTietSanPhams.Count;

        var sanPhamOptions = `@Html.Raw(string.Join("", sanPhamList.Select(sp => $"<option value='{sp.Id}'>{sp.TenSanPham}</option>")))`;

        $("#addRow").click(function () {
            var row = `<tr>
                <td>
                    <select name="ChiTietSanPhams[${index}].SanPhamId" class="form-control" style="color:black">
                        <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>
                        ${sanPhamOptions}
                    </select>
                </td>
                <td><input type="number" name="ChiTietSanPhams[${index}].SoLuong" value="1" class="form-control" min="1" style="color:black"/></td>
                <td><input type="number" name="ChiTietSanPhams[${index}].GiaNhap" value="0" class="form-control" min="0" style="color:black"/></td>
                <td>0</td>
                <td><button type="button" class="btn btn-danger removeRow">X√≥a</button></td>
            </tr>`;
            $("#productTable tbody").append(row);
            index++;
        });

        $(document).on("click", ".removeRow", function () {
            $(this).closest("tr").remove();
        });
    </script>
}
